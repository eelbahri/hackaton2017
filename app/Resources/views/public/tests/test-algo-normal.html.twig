{% extends 'base.html.twig' %}
{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="/css/jquery.fullPage.css">
    <link rel="stylesheet" type="text/css" href="/css/style-test.css">
{% endblock %}
{% block javascripts %}
    <script src="/js/jquery.fullPage.js"></script>
{% endblock %}
{% block body %}
    <div class="container-fluid">
        <div id="fullpage">
            <div class="alert alert-success fade in">
                <strong>Victoire !</strong> Vous avez correctement répondu aux questions
            </div>
            <div class="alert alert-danger fade in">
                <strong>Dommage !</strong> Vous avez raté le test
            </div>
            <div class="alert alert-info fade in">
                <strong>Erreur !</strong> Renvoyer le formulaire
            </div>
            <div class="alert alert-warning">
                <strong>Attention!</strong> Vous n'avez pas répondu à toutes les questions
            </div>

            {# Timer #}
            <div class="progress progress-striped active">
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
            {# /Timer #}

            <div class="section" id="section1">
                <div class="slide" id="slide1" data-anchor="slide1">
                    <div class="intro">
                        <img class="logo-qcm" src="/assets/logo-qcm.png" alt="">
                        <h1><strong>Bienvenue !</strong> </h1>
                        <p>
                            Vous avez 20 minutes pour compléter ces tests. <br>
                            Le compteur se déclenchera à votre clic sur le button "démarrer". <br>
                            Sélectionner la bonne réponse et passez à la suivante. <br>
                            Attention : vous ne pourrez pas retourner en arrière <br>
                            A la fin, nous vous  proposerons  un entretien si vous avez réussi le test.
                        </p>
                    </div>
                    <div class="next center">
                        DEMARRER
                    </div>
                </div>

                <div class="slide" id="slide2" data-anchor="slide2">
                    <img class="logo-qcm-small" src="/assets/logo-qcm.png" alt="">
                    <h2 class="intitule">Quel est l'opérateur capable de stocker une valeur dans une variable ?</h2>
                    <label class="radio"><input type="radio" name="optradio1" value="1"><span>/</span></label>
                    <label class="radio"><input type="radio" name="optradio1" value="2"><span>*</span></label>
                    <label class="radio"><input type="radio" name="optradio1" value="3"><span>=</span></label>
                    <div class="next right">
                        Question suivante
                    </div>
                </div>


                <div class="slide" id="slide3" data-anchor="slide3">
                    <img class="logo-qcm-small" src="/assets/logo-qcm.png" alt="">
                    <h2 class="intitule">Comment s'appelle l'action qui soustrait un d'une variable ?</h2>
                    <label class="radio"><input type="radio" name="optradio2" value="1"><span>Incrémentation</span></label>
                    <label class="radio"><input type="radio" name="optradio2" value="2"><span>Décrémentation</span></label>
                    <label class="radio"><input type="radio" name="optradio2" value="3"><span>Comparaison</span></label>
                    <div class="next right">
                        Question suivante
                    </div>
                </div>

                <div class="slide" id="slide4" data-anchor="slide4">
                    {# POPUP #}
                    <div id="popup-overlay"></div>
                    <div id="popup">
                        <div class="headline">
                            <img class="logo-qcm-popin" src="/assets/logo-qcm.png" alt="">
                        </div>
                        <div class="content">
                            <p>
                                Félicitations ! <br>
                                Vous avez passé les tests avec succès. <br>
                                Veuillez choisir un créneau horaire pour votre entretien. <br>
                                Si aucun horaire ne vous convient, <br>
                                contactez le gfimail@mail.com
                            </p>
                            <div class="date">
                                <label class="radio"><input type="radio" name="optradio3" value="1"><span>mardi 25 avril 15h45</span></label>
                                <label class="radio"><input type="radio" name="optradio3" value="2"><span>jeudi 27 avril 9h00</span></label>
                                <label class="radio"><input type="radio" name="optradio3" value="3"><span>vendredi 28 avril à 15h45</span></label>
                            </div>
                            <button type="submit" id="submitRdv">Envoyer</button>
                        </div>
                    </div>
                    {# / POPUP #}
                    <img class="logo-qcm-small" src="/assets/logo-qcm.png" alt="">
                    <h2 class="intitule">Parmi les éléments suivants, quel est celui qui permet de stocker une valeur ?</h2>
                    <label class="radio"><input type="radio" name="optradio4" value="1"><span>Opérateur</span></label>
                    <label class="radio"><input type="radio" name="optradio4" value="2"><span>Variable</span></label>
                    <label class="radio"><input type="radio" name="optradio4" value="3"><span>Expression</span></label>
                    <div class="next right finish">
                        Terminé
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('.navbar').hide();

            $('#fullpage').fullpage({
                anchors:['slide1', 'slide2', 'slide3']
            });

            //Progress Bar
            var steps = 4; // Get number of questions
            var step = 100 / steps;
            function move() {
                var elem = $('.progress-bar');
                var width = parseInt(elem.attr('aria-valuenow'));
                if (width >= 100) {
                    width = 0;
                } else {
                    width = width + step;
                }
                elem.css('width', width+'%').attr('aria-valuenow', width);
            }

            // Progress Bar click
            $('.fp-next').on('click', function () {
                move();
            });

            // Hide left arrow navigation
            $('.fp-prev').hide();
        });

        // close popup rdv
        $('.close').click(function() {
            $('#popup-overlay').fadeOut('slow');
            $('#popup').fadeOut('fast');
        });

        $('.alert').on('click', function () {
            $(this).hide();
        });

        // Submit QCM action
        $('.finish').on('click', function () {
            var answers = new Array();

            $('input:checked').each(function () {
                answers.push($(this).val());
            });
            console.log(answers);
            // Compare le nombre de questions avec le nombre de questions
            if (answers.length != $('div.slide h2').length) {
                $('.alert-warning').show();
                return;
            }

            $.ajax({
                url : '/post/ajax/correctAnswers',
                type : 'POST',
                data : {
                    'answers' : answers
                },
                dataType:'json',
                success : function(data) {
                    $('button#submitButton').prop('disabled', true);
                    if (data.success) {
                        // Animate Popup
                        $('#popup-overlay').fadeIn('fast');
                        $('#popup').fadeIn('slow');
                    } else {
                        $('.alert-danger').show();
                    }
                },
                error : function(request,error)
                {
                    $('.alert-info').show();
                }
            });

        });


//        RDV SUBMIT BUTTON
        $('button#submitRdv').on('click', function () {
            var meets = new Array();

            $('.content input:checked').each(function() {
                meets.push($(this).attr('value'));
            });

            if(!meets.length) {
                return
            }

            $.ajax({
                url : '/post/ajax/saveMeetAction',
                type : 'POST',
                data : {
                    'meets' : meets
                },
                dataType:'json',
                success : function(data) {
                    $('#popup-overlay').fadeOut('slow');
                    $('#popup').fadeOut('fast');
                    $('.success-message').fadeIn('slow');
                    $('#submitButton').fadeOut('fast');
                },
                error : function(request,error)
                {
                    $('.alert-info').show();
                }
            });
        });
    </script>
{% endblock %}